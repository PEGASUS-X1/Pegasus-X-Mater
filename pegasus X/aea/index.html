<!DOCTYPE html>
<html>
<head>
    <title>Subir y Mostrar Imágenes</title>
    <link rel="stylesheet" href="./carga.css">
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-storage.js"></script>
</head>
<body>
    <script>
        // Definir un objeto que mapea nombres de usuario a contraseñas
      var usuariosContrasenas = {
          "admin": {
              password: "admin",
              modelo: "💎 Premiun 💎",
              imagen: "https://i.pinimg.com/564x/69/8b/3b/698b3b755ed139278036e55264a8e0da.jpg" // Reemplaza "url_de_la_imagen_de_Arquitecto_Sandro.jpg" con la URL de la imagen
          },
          "Arquitecto Sandro": {
              password: "admin",
              mensaje: "Pago: te faltan 2 días",
              modelo: "Basico",
              imagen: "https://i.pinimg.com/564x/69/8b/3b/698b3b755ed139278036e55264a8e0da.jpg" // Reemplaza "url_de_la_imagen_de_Arquitecto_Sandro.jpg" con la URL de la imagen
          },
          "Usuario2": {
            password: "admin",
            modelo: "💎 Premiun 💎",
            imagen: "./1.jpg" // Reemplaza "url_de_la_imagen_de_Arquitecto_Sandro.jpg" con la URL de la imagen
          }
      };
      
      $(document).ready(function () {
          var lastSecurityCheckDate = localStorage.getItem('lastSecurityCheckDate');
          var today = new Date().toLocaleDateString();
      
          if (lastSecurityCheckDate === today) {
              showWelcomeMessage();
          } else {
              performSecurityCheck();
          }
      });
      
      function showWelcomeMessage() {
          var username = localStorage.getItem('username');
          var username = localStorage.getItem('username');
          if (username) {
              var saludo = "Hola, " + username + " Bienvenid@!";
              textoGenerado.textContent = saludo;
      
              var TipoModelos = localStorage.getItem('TipoModelo');
      
              if (TipoModelos){
                var TipoModelo = document.getElementById("Modelo-user");
                TipoModelo.textContent = TipoModelos;
                        //     // Comprobar si el modelo es "Premium" y ocultar el elemento con id "password"
                        //     if (TipoModelos === "💎 Premiun 💎") {
                        //       var passwordElement = document.getElementById("password");
                        //       passwordElement.style.display = "none";
                        //   }
              }
      
              // Mostrar mensaje de bienvenida si el control de seguridad ya se realizó hoy
              // alert("¡Hola, " + username + "! Bienvenido.");
      
              // Mostrar la imagen de usuario almacenada en el almacenamiento local
              var imagenUsuarioURL = localStorage.getItem('imagenUsuario');
              if (imagenUsuarioURL) {
                var imagenUsuario = document.getElementById("img-user");
                  imagenUsuario.src = imagenUsuarioURL;
                  imagenUsuario.alt = "Imagen de Usuario";
                  // document.getElementById("texto-generado").appendChild(imagenUsuario);
              }
          } else {
              performSecurityCheck();
          }
          hideLoader();
      }
      
      function performSecurityCheck() {
          var maxAttempts = 3;
          var attempts = 0;
          var isAvisoMostrado = false;
          var controluno = false;
          var controldos = false;
      
          function showLoader() {
              $("#overlay").fadeIn();
          }
      
          function hideLoader() {
              $("#overlay").fadeOut();
          }
      
          function guardarDatos(nombre) {
            //var fechaHora = obtenerFechaHora();
            //var url = "https://script.google.com/macros/s/AKfycby1aVTFUQOvTLePapUGtgR-nZ49jo_Z3NDJBQpbIFM_o0ucMMBzOlVXwcqHjqD--N27/exec";
            //var data = {
            //    nombre: nombre
            //};
      
            //$.post(url, JSON.stringify(data), function (response) {
            //    alert(response);
            //});
      
              var lastReloadDate = localStorage.getItem('lastReloadDate');
              var today = new Date().toLocaleDateString();
      
              if (lastReloadDate !== today) {
                  setTimeout(function () {
                      localStorage.setItem('lastReloadDate', today);
                      window.location.reload();
                  }, 5000);
              }
          }
      
          function obtenerFechaHora() {
              var now = new Date();
              var fecha = now.toLocaleDateString();
              var hora = now.toLocaleTimeString();
              return fecha + " " + hora;
          }
      
          function checkNombre() {
              if (attempts < maxAttempts) {
                  if (!isAvisoMostrado) {
                      alert("😋 ¡Hola! Es hora de acceder. 😋\n🤭 Si no tienes tus claves, accede a este\n🔗 link: 'pegasus-v2.tk/registro' 🔗 para obtener tu acceso. 😏\n\n☠️ ¡No te equivoques! ☠️");
                      isAvisoMostrado = true;
                  }
      
                  if (!controluno) {
                      alert("Control De Seguridad 1");
                      controluno = true;
                  }
      
                  var username = prompt("Ingrese el nombre de seguridad");
      
                  if (usuariosContrasenas.hasOwnProperty(username)) {
                      checkCodigo(username);
                  } else {
                      attempts++;
                      alert("Nombre de seguridad incorrecto. Intento " + attempts + " de " + maxAttempts);
                      checkNombre();
                  }
              } else {
                  showLoader();
                  setTimeout(hideLoader, 5000);
                  window.location.href = "404.html";
              }
          }
      
          function checkCodigo(username) {
            if (attempts < maxAttempts) {
                if (!controldos) {
                    alert("Control De Seguridad 2");
                    controldos = true;
                }
        
                var codigo = prompt("Ingrese la contraseña");
        
                if (usuariosContrasenas[username].password === codigo) {
                    showLoader();
                    setTimeout(function () {
                        hideLoader();
                        var saludo = "Hola, " + username + " Bienvenid@!";
                        textoGenerado.textContent = saludo;
      
                        var TipoModelos = usuariosContrasenas[username].modelo;
                        var TipoModelo = document.getElementById("Modelo-user");
                        TipoModelo.textContent = TipoModelos;
                        localStorage.setItem('TipoModelo', TipoModelos);
      
                        // Agregar imagen de usuario aquí
                        var imagenUsuarioURL = usuariosContrasenas[username].imagen;
                        var imagenUsuario = document.getElementById("img-user");
                        imagenUsuario.src = imagenUsuarioURL;
                        imagenUsuario.alt = "Imagen de Usuario";
                        // document.getElementById("texto-generado").appendChild(imagenUsuario);
      
                        // Almacenar la URL de la imagen en el almacenamiento local
                        localStorage.setItem('imagenUsuario', imagenUsuarioURL);
        
                        if (username === 'admin') {
                            // Mostrar una alerta específica para el usuario 'admin'
                            alert("¡Acceso de administrador!");
                        } else {
                            alert(" ✅ Acceso concedido ✅ ");
                        }
                        if (usuariosContrasenas[username].mensaje) {
                          alert(usuariosContrasenas[username].mensaje);
                      }
      
                        guardarDatos(username, imagenUsuarioURL, TipoModelos);
        
                        var today = new Date().toLocaleDateString();
                        localStorage.setItem('lastSecurityCheckDate', today);
        
                        localStorage.setItem('username', username);
                    }, 5000);
                } else {
                    attempts++;
                    alert("Contraseña incorrecta. Intento " + attempts + " de " + maxAttempts);
                    checkCodigo(username);
                }
            } else {
                showLoader();
                setTimeout(hideLoader, 5000);
                window.location.href = "404.html";
            }
        }
      
          showLoader();
          checkNombre();
      }
      
      function showLoader() {
          var lastSecurityCheckDate = localStorage.getItem('lastSecurityCheckDate');
          var today = new Date().toLocaleDateString();
      
          if (lastSecurityCheckDate !== today) {
              $("#overlay").fadeIn();
          }
      }
      
      function hideLoader() {
          $("#overlay").fadeOut();
      }
      
      var textoGenerado = document.getElementById("texto-generado");
      </script>
          <p class="Modelo-user" id="Modelo-user"></p>
          <h1 id="texto-generado"></h1>
          <img src="" id="img-user" alt="">
    <h3>Cargador de archivos Cloud Storage</h3>
    <!-- <input id="fileToUpload" type="file"> -->
    <div class="cargador-archivos">

    <input type="file" id="fileToUpload" style="display: none">
<h1 onclick="selectFile()">Seleccionar archivo</h1>
<br>
<input type="text" id="fileName" value="Ningún archivo seleccionado" disabled>
<h1 onclick="subirArchivo()">Cargar</h1>

</div>
<br>
    
<div id="imageContainer">
</div>

<script>
function selectFile() {
  document.getElementById('fileToUpload').click();
}

document.getElementById('fileToUpload').addEventListener('change', function() {
  const fileInput = document.getElementById('fileToUpload');
  const fileNameDisplay = document.getElementById('fileName');
  if (fileInput.files.length > 0) {
    fileNameDisplay.value = fileInput.files[0].name;
  } else {
    fileNameDisplay.value = "Ningún archivo seleccionado";
  }
});
</script>

    <script>
    // sustituye aquí tus credenciales
    var firebaseConfig = {
        apiKey: "AIzaSyCowkKlW7BEgdp_8GeRfQgg42OkSOrGzm8",
  authDomain: "fotos-b8a54.firebaseapp.com",
  projectId: "fotos-b8a54",
  storageBucket: "fotos-b8a54.appspot.com",
  messagingSenderId: "1037713159028",
  appId: "1:1037713159028:web:7386b0783a47e73f8b7221",
  measurementId: "G-909LJ5JLLG"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    
</script>

<script>
async function subirArchivo() {
    var inputFile = document.getElementById("fileToUpload");
    var imageContainer = document.getElementById("imageContainer");

    if (inputFile.files.length == 0) {
        alert("Por favor selecciona un archivo");
        return;
    }

    var file = inputFile.files[0];
    var username = localStorage.getItem('username');

    if (!username) {
        alert("Debes iniciar sesión para subir archivos.");
        return;
    }

    // Crear una referencia al directorio del usuario en Firebase Storage
    var storageRef = firebase.storage().ref(username + "/" + file.name);

    try {
        await storageRef.put(file);
        console.log("Carga completada...");

        var imagePath = username + "/" + file.name;
        mostrarImagen(imagePath, imageContainer);
    } catch (error) {
        console.error("Error al subir el archivo:", error);
        alert("Ocurrió un error al subir el archivo. Por favor, inténtalo de nuevo.");
    }
}

    async function mostrarImagen(path, container) {
        var storageRef = firebase.storage().ref(path);
        var url = await storageRef.getDownloadURL();

        var imageElement = document.createElement("img");
        imageElement.src = url;
        container.appendChild(imageElement);

        var buttonElement = document.createElement("button");
        buttonElement.textContent = "Copiar URL de la Imagen";
        buttonElement.onclick = function () {
            copiarURL(url);
        };
        container.appendChild(buttonElement);
    }

    function copiarURL(url) {
        var tempInput = document.createElement("input");
        document.body.appendChild(tempInput);
        tempInput.value = url;
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert("URL de la imagen copiada al portapapeles: " + url);
    }
    
</script>
<script>
    var textoGenerado = document.getElementById("texto-generado");
</script>
<script src="/CreativeScale-Architecture/assets/js/pedidos.js"></script>